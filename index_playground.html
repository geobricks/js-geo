<html>

    <head>

        <title>JS Geo</title>

        <meta name='viewport' content='width=device-width, initial-scale=1.0'>

        <link href='http://fonts.googleapis.com/css?family=Roboto:400,900,700|Roboto+Condensed:400,300,700' rel='stylesheet' type='text/css'>

        <link rel="stylesheet" href="http://fenixapps.fao.org/repository/js/leaflet/0.7.2/leaflet.css" />
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="http://fenixapps.fao.org/repository/css/jquery.power.tip/1.1.0/jquery.powertip.css" type="text/css" />
        <link rel="stylesheet" href="http://fenixapps.fao.org/repository/js/jquery-ui/1.10.3/jquery-ui-1.10.3.custom.min.css" />
        <link rel="stylesheet" href="http://localhost:7070/fenix-map-js/fenix-map-js.css" />
        <link rel="stylesheet" href="http://localhost:7070/fenix-map-js/leaflet-custom.css" />

        <link rel='icon' type='image/png' href='http://fenixapps.fao.org/repository/favicon/faostat.png'>
        <link href='http://netdna.bootstrapcdn.com/bootstrap/3.0.1/css/bootstrap.min.css' rel='stylesheet'>
        <link href='http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css' rel='stylesheet'>
        <link href='http://fenixapps.fao.org/repository/js/chosen/1.0.0/chosen.min.css' rel='stylesheet'>
        <link href='css/js-geo.css' rel='stylesheet'>

        <script type='text/javascript' src='http://code.jquery.com/jquery-1.10.1.min.js'></script>

        <script type="application/javascript">
            function test() {
                var data = [
                    {
                        'file_name': 'MOD13Q1.A2012097.h00v08.005.2012114105915.hdf',
                        'size': '5146512',
                        'file_path': 'ftp://ladsweb.nascom.nasa.gov/allData/5/MOD13Q1/2012/097/MOD13Q1.A2012097.h00v08.005.2012114105915.hdf',
                        'label': 'H 00, V 08 (5.15 MB)'
                    }
                ];
                $.ajax({
                    url: 'http://127.0.0.1:5005/browse/modis/mod13a1/2014/001/',
                    type: 'GET',
                    dataType: 'json',
                    success: function (response) {
                        var json = response;
                        if (typeof json == 'string')
                            json = $.parseJSON(response);
                        $.ajax({
                            url: 'http://127.0.0.1:5005/download/modis/',
                            type: 'POST',
                            dataType: 'json',
                            data: JSON.stringify(json),
                            contentType: 'application/json',
                            success: function (response) {
                                progress(json);
                            }
                        });
                    }
                });
            };
            function progress(json) {
                for (var i = 0 ; i < json.length ; i++) {
                    var s = '';
                    s += '<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">';
                    s += '<div class="progress">';
                    s += '<div id="' + json[i]['file_name'] + '" class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">';
                    s += json[i]['file_name'];
                    s += '</div>';
                    s += '</div>';
                    s += '</div>';
                    $('#progress_bars').append(s);
                    if (i == 0) {
                        var timer = setInterval(function (id) {
                            $.ajax({
                                url: 'http://127.0.0.1:5005/download/progress/' + id + '/',
                                type: 'GET',
                                success: function (progress) {
                                    console.log(progress.progress);
                                    $(document.getElementById(id)).attr('aria-valuenow', progress.progress);
                                    $(document.getElementById(id)).css('width', progress.progress + '%');
                                }
                            });
                        }, 1000, json[i]['file_name']);
                    }
                }
            };
            function update_progress(id) {
                console.log(id);

            };
        </script>

    </head>

    <body>
        <div class="container">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <button style="width: 100%;" onclick="test();" class="btn btn-info">
                    Click Me
                </button>
            </div>
            <div id="progress_bars">

            </div>
        </div>
    </body>

</html>